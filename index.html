<!DOCTYPE html>
<html>
    <head>
		<title id="titlename">飛蝶大逃亡</title>
		<link id="icondemo" rel="icon" href="./images/butterfly1.png">
		<meta charset="utf-8">
		<meta name="author" content="Andy Chang">
		<meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
        <link rel="stylesheet" href="./CSS_PiKing.css">
        <audio src="./sounds/Believe.mp3" preload="auto" autoplay loop></audio>
    </head>
    <script src="./JavaScript_Functions_PiKing.js"></script>
    <body onload="startGame()">
        <button id = "next" onclick="next()" style="font-size:20px; font-family:Consolas; position: fixed; top:200px; left:300px;">Next</button>
        <button id = "restart" onclick="refresh()" style="font-size:20px; font-family:Consolas; position: fixed; top:243px; left:280px; display: none;">Restart</button>
        <script>        
            var level = 0;
            //遊戲空間轉換設定
            function next() 
            {
                if (level == 0)
                {
                    level = 1;
                    document.getElementById("next").style.display="none";
                }
            }
            //遊戲初始物品設定
            function startGame()
            {
                GameArea.start(660,280,20);
                Background = new object(700, 450, "./images/background.png", 0, 0, "background");
                LobbyText = new object("50px", "Consolas", "black", 100, 100, "text");
                LobbyImg = new object(400, 210, "./images/Flappy_Butterfly.png", 120, 60, "image");
                Player = new object(30, 30, "./images/butterfly1.png" , 40, 120, "image");
                Player.gravity = 0.05;
                Player.gravitySpeed = 0;
                UpBtn = new object(50, 50, "./images/upbutton.png", 10, 150, "image");
                DownBtn = new object(50, 50, "./images/downbutton.png", 10, 230, "image");
                GameArea.timer = 0;
                Enemy = [];
                Score = new object("30px", "Consolas", "black", 270, 40, "text");
                GameArea.nowscore = 0;
                EndSound = new sound("./sounds/end.wav");
            }
            //遊戲不斷執行設定
            function LoopGame() 
            {
                if (level==0)
                {
                    GameArea.clear();
                    Background.speedX = -0.5;
                    Background.newPosition();
                    Background.newShow();
                    LobbyText.text = "Flappy Butterfly";
                    LobbyText.newShow();
                    LobbyImg.newShow();
                }else if (level==1)
                {
                    //碰撞事件
                    for (i = 0; i < Enemy.length; i += 1) 
                    {
                        if (Player.collision(Enemy[i])) 
                        {
                            GameArea.stop();
                            EndSound.play();
                            document.getElementById("restart").style.display="";
                            return;
                        } 
                    }
                    //畫布清除
                    GameArea.clear();
                    //背景
                    Background.speedX = -0.5;
                    Background.newPosition();
                    Background.newShow();
                    //玩家
                    //操控事件
                    if (GameArea.key_is_pressed && GameArea.key_is_pressed[38]) {move(Player,'up',2);/*rotation(Player,-1)*/}
                    if (GameArea.key_is_pressed && GameArea.key_is_pressed[40]) {move(Player,'down',2);}
                    if (GameArea.key_is_pressed && GameArea.key_is_pressed[87]) {move(Player,'up',2);/*rotation(Player,-1)*/}
                    if (GameArea.key_is_pressed && GameArea.key_is_pressed[83]) {move(Player,'down',2);}
                    if (GameArea.x && GameArea.y) 
                    {
                        if (UpBtn.clicked()) 
                        {
                            move(Player,'up',2);
                        }
                        if (DownBtn.clicked()) 
                        {
                            move(Player,'down',2);
                        }
                    }
                    Player.newPosition();
                    Player.newShow();
                    UpBtn.newShow();
                    DownBtn.newShow();
                    //產生器
                    GameArea.timer += 1;
                    if (GameArea.nowscore < 5)
                    {
                        if (GameArea.timer == 1 || everytimer(300))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -1;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 5 && GameArea.nowscore < 15)
                    {
                        if (GameArea.timer == 1 || everytimer(150))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -2;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 15 && GameArea.nowscore < 30)
                    {
                        if (GameArea.timer == 1 || everytimer(100))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -3;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 30 && GameArea.nowscore < 60)
                    {
                        if (GameArea.timer == 1 || everytimer(75))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -4;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 60 && GameArea.nowscore < 120)
                    {
                        if (GameArea.timer == 1 || everytimer(60))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -5;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 120 && GameArea.nowscore < 150)
                    {
                        if (GameArea.timer == 1 || everytimer(50))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -6;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 150 && GameArea.nowscore < 180)
                    {
                        if (GameArea.timer == 1 || everytimer(40))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -7;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 180 && GameArea.nowscore < 210)
                    {
                        if (GameArea.timer == 1 || everytimer(30))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -8;
                            Enemy[i].newShow();
                        }
                    }else if (GameArea.nowscore >= 210)
                    {
                        if (GameArea.timer == 1 || everytimer(20))
                        {
                            x = GameArea.canvas.width;
                            minHeight = 20;
                            maxHeight = 230;
                            height = getRandom(minHeight,maxHeight);
                            minGap = 70;
                            maxGap = 200;
                            gap = getRandom(minGap,maxGap);
                            imgc = getRandom(1,3);
                            if (imgc==1)
                            {
                                color = "green";
                            }else if (imgc==2)
                            {
                                color = "red";
                            }else
                            {
                                color = "blue";
                            }
                            Enemy.push(new object(20, height, color, x, 0));
                            Enemy.push(new object(20, x - height - gap, color, x, height + gap));
                        }
                        for (i = 0; i < Enemy.length; i += 1) 
                        {
                            Enemy[i].x += -9;
                            Enemy[i].newShow();
                        }
                    }
                    //遊戲機制引用
                    border();
                    addscore();
                    Score.text = "SCORE: " + GameArea.nowscore;
                    Score.newShow();
                }
            }
            //遊戲機制
            function border()
            {
                if (Player.y <= 0)
                {
                    Player.y = 0;
                }
                if (Player.y > GameArea.canvas.height - Player.height)
                {
                    Player.y = GameArea.canvas.height - Player.height;
                    Player.gravitySpeed = 0;
                    GameArea.stop();
                    EndSound.play();
                    document.getElementById("restart").style.display="";
                }
            }
            function addscore()
            {
                for (i = 0; i < Enemy.length; i += 1) 
                {
                    if (Enemy[i].x<=20)
                    {
                        GameArea.nowscore += 0.5;
                        Enemy.splice(i, 1);
                    }
                }        
            }
        </script>
    </body>
</html>